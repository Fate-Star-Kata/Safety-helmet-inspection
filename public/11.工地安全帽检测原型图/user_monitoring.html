<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>实时监控 - 工地安全帽检测系统</title>
    <link rel="stylesheet" href="styles.css">
    <style>
        .monitoring-grid {
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: 2rem;
            margin-bottom: 2rem;
        }
        
        .camera-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 1rem;
        }
        
        .camera-card {
            background: white;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }
        
        .camera-header {
            background: #667eea;
            color: white;
            padding: 1rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .camera-status {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        .status-dot {
            width: 10px;
            height: 10px;
            border-radius: 50%;
            background: #4CAF50;
            animation: pulse 2s infinite;
        }
        
        .detection-overlay {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            pointer-events: none;
        }
        
        .detection-box {
            position: absolute;
            border: 3px solid #4CAF50;
            background: rgba(76, 175, 80, 0.1);
        }
        
        .detection-box.no-helmet {
            border-color: #f44336;
            background: rgba(244, 67, 54, 0.1);
        }
        
        .detection-label {
            position: absolute;
            top: -25px;
            left: 0;
            background: #4CAF50;
            color: white;
            padding: 2px 8px;
            font-size: 12px;
            border-radius: 3px;
        }
        
        .detection-label.no-helmet {
            background: #f44336;
        }
        
        @media (max-width: 768px) {
            .monitoring-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <!-- 导航栏 -->
    <nav class="navbar">
        <div class="nav-container">
            <a href="#" class="logo">🏗️ 安全帽检测系统</a>
            <ul class="nav-menu">
                <li><a href="user_index.html">首页</a></li>
                <li><a href="user_monitoring.html" class="active">实时监控</a></li>
                <li><a href="user_warning_history.html">警告记录</a></li>
                <li><a href="user_statistics.html">统计信息</a></li>
                <li><a href="#" onclick="logout()">退出登录</a></li>
            </ul>
        </div>
    </nav>

    <!-- 主要内容 -->
    <div class="container">
        <div class="card">
            <h1>📹 实时监控</h1>
            <p>实时监控工地安全帽佩戴情况，基于YOLOv11算法进行智能检测</p>
        </div>

        <!-- 监控布局 -->
        <div class="monitoring-grid">
            <!-- 摄像头监控区域 -->
            <div>
                <div class="camera-grid">
                    <!-- 摄像头1 -->
                    <div class="camera-card">
                        <div class="camera-header">
                            <span>📹 摄像头 #1 - 主入口</span>
                            <div class="camera-status">
                                <div class="status-dot"></div>
                                <span>在线</span>
                            </div>
                        </div>
                        <div class="video-container" style="position: relative;">
                            <img src="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNDAwIiBoZWlnaHQ9IjMwMCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KICA8cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSIjY2NjIi8+CiAgPHRleHQgeD0iNTAlIiB5PSI1MCUiIGZvbnQtZmFtaWx5PSJBcmlhbCwgc2Fucy1zZXJpZiIgZm9udC1zaXplPSIxOCIgZmlsbD0iIzMzMyIgdGV4dC1hbmNob3I9Im1pZGRsZSIgZHk9Ii4zZW0iPuWunuaXtuebkeaOp+eUu+mdojwvdGV4dD4KPC9zdmc+" 
                                 alt="实时监控画面" class="video-stream">
                            <!-- 检测框覆盖层 -->
                            <div class="detection-overlay">
                                <div class="detection-box" style="top: 20%; left: 30%; width: 15%; height: 25%;">
                                    <div class="detection-label">安全帽 98%</div>
                                </div>
                                <div class="detection-box no-helmet" style="top: 40%; left: 60%; width: 18%; height: 30%;">
                                    <div class="detection-label no-helmet">未戴安全帽 95%</div>
                                </div>
                            </div>
                            <div class="video-overlay">
                                检测中... <div class="loading"></div>
                            </div>
                        </div>
                    </div>

                    <!-- 摄像头2 -->
                    <div class="camera-card">
                        <div class="camera-header">
                            <span>📹 摄像头 #2 - 施工区A</span>
                            <div class="camera-status">
                                <div class="status-dot"></div>
                                <span>在线</span>
                            </div>
                        </div>
                        <div class="video-container" style="position: relative;">
                            <img src="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNDAwIiBoZWlnaHQ9IjMwMCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KICA8cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSIjY2NjIi8+CiAgPHRleHQgeD0iNTAlIiB5PSI1MCUiIGZvbnQtZmFtaWx5PSJBcmlhbCwgc2Fucy1zZXJpZiIgZm9udC1zaXplPSIxOCIgZmlsbD0iIzMzMyIgdGV4dC1hbmNob3I9Im1pZGRsZSIgZHk9Ii4zZW0iPuWunuaXtuebkeaOp+eUu+mdojwvdGV4dD4KPC9zdmc+" 
                                 alt="实时监控画面" class="video-stream">
                            <div class="detection-overlay">
                                <div class="detection-box" style="top: 25%; left: 20%; width: 12%; height: 20%;">
                                    <div class="detection-label">安全帽 96%</div>
                                </div>
                                <div class="detection-box" style="top: 35%; left: 45%; width: 14%; height: 25%;">
                                    <div class="detection-label">安全帽 92%</div>
                                </div>
                            </div>
                            <div class="video-overlay">
                                检测中... <div class="loading"></div>
                            </div>
                        </div>
                    </div>

                    <!-- 摄像头3 -->
                    <div class="camera-card">
                        <div class="camera-header">
                            <span>📹 摄像头 #3 - 施工区B</span>
                            <div class="camera-status">
                                <div class="status-dot" style="background: #FF9800;"></div>
                                <span>警告</span>
                            </div>
                        </div>
                        <div class="video-container" style="position: relative;">
                            <img src="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNDAwIiBoZWlnaHQ9IjMwMCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KICA8cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSIjY2NjIi8+CiAgPHRleHQgeD0iNTAlIiB5PSI1MCUiIGZvbnQtZmFtaWx5PSJBcmlhbCwgc2Fucy1zZXJpZiIgZm9udC1zaXplPSIxOCIgZmlsbD0iIzMzMyIgdGV4dC1hbmNob3I9Im1pZGRsZSIgZHk9Ii4zZW0iPuWunuaXtuebkeaOp+eUu+mdojwvdGV4dD4KPC9zdmc+" 
                                 alt="实时监控画面" class="video-stream">
                            <div class="detection-overlay">
                                <div class="detection-box no-helmet pulse" style="top: 30%; left: 40%; width: 20%; height: 35%;">
                                    <div class="detection-label no-helmet">未戴安全帽 97%</div>
                                </div>
                            </div>
                            <div class="video-overlay" style="background: rgba(255,0,0,0.8);">
                                ⚠️ 检测到违规
                            </div>
                        </div>
                    </div>

                    <!-- 摄像头4 -->
                    <div class="camera-card">
                        <div class="camera-header">
                            <span>📹 摄像头 #4 - 材料区</span>
                            <div class="camera-status">
                                <div class="status-dot"></div>
                                <span>在线</span>
                            </div>
                        </div>
                        <div class="video-container">
                            <img src="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNDAwIiBoZWlnaHQ9IjMwMCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KICA8cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSIjY2NjIi8+CiAgPHRleHQgeD0iNTAlIiB5PSI1MCUiIGZvbnQtZmFtaWx5PSJBcmlhbCwgc2Fucy1zZXJpZiIgZm9udC1zaXplPSIxOCIgZmlsbD0iIzMzMyIgdGV4dC1hbmNob3I9Im1pZGRsZSIgZHk9Ii4zZW0iPuaXoOS6uuWRmOajgOa1i+eUu+mdojwvdGV4dD4KPC9zdmc+" 
                                 alt="实时监控画面" class="video-stream">
                            <div class="video-overlay">
                                无人员检测
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- 警告信息面板 -->
            <div>
                <div class="card">
                    <h2>🚨 实时警告</h2>
                    <div id="warningPanel">
                        <div class="alert alert-danger">
                            <strong>严重警告</strong><br>
                            摄像头#3检测到未佩戴安全帽人员<br>
                            <small>2024-01-15 14:32:15</small>
                        </div>
                        <div class="alert alert-warning">
                            <strong>一般警告</strong><br>
                            摄像头#1检测到可疑行为<br>
                            <small>2024-01-15 14:28:42</small>
                        </div>
                    </div>
                </div>

                <div class="card">
                    <h2>📊 实时统计</h2>
                    <table class="table">
                        <tr>
                            <td>当前在线人员</td>
                            <td><span id="onlineCount">8</span> 人</td>
                        </tr>
                        <tr>
                            <td>佩戴安全帽</td>
                            <td><span style="color: #4CAF50;">6</span> 人</td>
                        </tr>
                        <tr>
                            <td>未佩戴安全帽</td>
                            <td><span style="color: #f44336;">2</span> 人</td>
                        </tr>
                        <tr>
                            <td>合规率</td>
                            <td><span id="complianceRate">75%</span></td>
                        </tr>
                    </table>
                </div>

                <div class="card">
                    <h2>⚙️ 监控控制</h2>
                    <div style="display: flex; flex-direction: column; gap: 1rem;">
                        <button class="btn btn-primary" onclick="toggleAllCameras()">📹 全部摄像头开/关</button>
                        <button class="btn btn-warning" onclick="exportWarnings()">📥 导出警告记录</button>
                        <button class="btn btn-success" onclick="resetAlerts()">🔄 重置警告</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        let warningCount = 0;
        
        /**
         * 模拟实时警告生成
         */
        function generateRandomWarning() {
            const warnings = [
                { type: 'danger', camera: '摄像头#1', message: '检测到未佩戴安全帽人员' },
                { type: 'warning', camera: '摄像头#2', message: '检测到可疑行为' },
                { type: 'danger', camera: '摄像头#3', message: '危险区域有人员未佩戴安全帽' },
                { type: 'warning', camera: '摄像头#4', message: '检测到人员聚集' }
            ];
            
            const randomWarning = warnings[Math.floor(Math.random() * warnings.length)];
            const now = new Date().toLocaleString('zh-CN');
            
            const warningPanel = document.getElementById('warningPanel');
            const newWarning = document.createElement('div');
            newWarning.className = `alert alert-${randomWarning.type}`;
            newWarning.innerHTML = `
                <strong>${randomWarning.type === 'danger' ? '严重警告' : '一般警告'}</strong><br>
                ${randomWarning.camera}${randomWarning.message}<br>
                <small>${now}</small>
            `;
            
            warningPanel.insertBefore(newWarning, warningPanel.firstChild);
            
            // 保持最多5条警告记录
            if (warningPanel.children.length > 5) {
                warningPanel.removeChild(warningPanel.lastChild);
            }
            
            // 播放警告音效（模拟）
            if (randomWarning.type === 'danger') {
                console.log('🚨 播放严重警告音效');
            }
        }
        
        /**
         * 切换所有摄像头状态
         */
        function toggleAllCameras() {
            alert('已切换所有摄像头状态');
        }
        
        /**
         * 导出警告记录
         */
        function exportWarnings() {
            alert('警告记录导出功能（实际项目中会下载CSV文件）');
        }
        
        /**
         * 重置警告
         */
        function resetAlerts() {
            document.getElementById('warningPanel').innerHTML = '<p>暂无警告信息</p>';
            alert('已重置所有警告');
        }
        
        /**
         * 用户登出功能
         */
        function logout() {
            if (confirm('确定要退出登录吗？')) {
                alert('已退出登录');
            }
        }
        
        /**
         * 页面初始化
         */
        document.addEventListener('DOMContentLoaded', function() {
            // 每10秒生成一次随机警告（模拟）
            setInterval(generateRandomWarning, 10000);
            
            // 每5秒更新统计数据
            setInterval(updateStats, 5000);
        });
        
        /**
         * 更新统计数据
         */
        function updateStats() {
            const onlineCount = document.getElementById('onlineCount');
            const complianceRate = document.getElementById('complianceRate');
            
            // 模拟数据变化
            const newCount = Math.floor(Math.random() * 5) + 6;
            const newRate = Math.floor(Math.random() * 20) + 80;
            
            onlineCount.textContent = newCount;
            complianceRate.textContent = newRate + '%';
        }
    </script>
</body>
</html>